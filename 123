# 全局配置 
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7894
allow-lan: true
bind-address: "*"
ipv6: false
unified-delay: true
tcp-concurrent: true
log-level: warning
find-process-mode: 'off'
# interface-name: en0
global-client-fingerprint: chrome
keep-alive-idle: 600
keep-alive-interval: 15
disable-keep-alive: false
profile:
  store-selected: true
  store-fake-ip: true

### DNS配置
dns:
  enable: true                      # 启用 Clash 内置 DNS
  listen: 0.0.0.0:1053              # DNS 监听端口，1053 避免和系统 53 冲突（旁路由要用 53 可以改成 0.0.0.0:53）
  ipv6: false                       # 禁用 IPv6 DNS，避免部分网络异常
  prefer-h3: true                   # 优先使用 DoH over HTTP/3 (QUIC)，速度更快（取决于上游是否支持）
  enhanced-mode: fake-ip            # Fake-IP 模式，解决 DNS 污染，保证分流准确
  fake-ip-range: 198.18.0.1/16      # Fake-IP 地址池（官方推荐段，避免与公网冲突）

  use-hosts: true                   # 允许使用 Clash 配置里的 hosts
  use-system-hosts: true            # 允许读取系统 /etc/hosts

  fake-ip-filter-mode: blacklist    # Fake-IP 过滤模式：黑名单模式（命中的域名不走 fake-ip）
  fake-ip-filter:                   # 不走 fake-ip 的域名（保持真实 IP 解析）
    - "rule-set:private_domain,cn_domain"  # 内网域名 & 中国域名直连
    - "rule-set:fakeip-filter,trackerslist" # 常见追踪器/黑名单域名
    - "+.msftconnecttest.com"       # Windows 网络检测
    - "+.msftncsi.com"              # Windows 网络检测
    - "time.*.com"                  # 时间同步服务
    - "+.market.xiaomi.com"         # 小米市场

  # 启动时用于解析代理服务器域名的默认 DNS（防止代理节点本身无法解析）
  default-nameserver:
    - 223.5.5.5                     # 阿里公共 DNS（纯 IP，不会被污染）

  # 解析代理服务器域名时用的 DNS（DoH，安全）
  proxy-server-nameserver:
    - https://223.5.5.5/dns-query   # 阿里 DoH
    - https://dns.pub/dns-query     # 360 DoH

  # 普通域名解析用的 DNS（直连查询，优先国内 DNS，保证国内解析快）
  nameserver:
    - https://223.5.5.5/dns-query   # 阿里 DoH
    - https://dns.pub/dns-query     # 360 DoH
    - https://dns.flymc.cc/dns-query # 第三方 DoH（可替换为你喜欢的，比如 Cloudflare 1.1.1.1）

  # 针对特定规则集的 DNS 策略（拦截无效/广告域名）
  nameserver-policy:
    {'rule-set:reject_non_ip,reject_domainset,reject_non_ip_drop,reject_non_ip_no_drop': [rcode://success]}


### 域名嗅探
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "+.baidu.com"

### 策略组
proxy-groups:
  - name: 🚀时光太浅1994
    type: select
    include-all: true
    proxies:
      - ♻️自动选择
      - 🔄故障转移
      - DIRECT

  - name: ♻️自动选择
    type: url-test
    include-all: true
    proxies: []  
    url: "https://cp.cloudflare.com/generate_204"
    interval: 180
    tolerance: 100

  - name: 🔄故障转移
    type: fallback
    include-all: true
    proxies: []
    url: "https://cp.cloudflare.com/generate_204"
    interval: 60

### 规则集配置（保持原参考文件的订阅规则）
RuleSet_classical: &RuleSet_classical {type: http, behavior: classical, interval: 43200, format: text, proxy: 🚀时光太浅1994}
RuleSet_domain: &RuleSet_domain {type: http, behavior: domain, interval: 43200, format: text, proxy: 🚀时光太浅1994}
RuleSet_ipcidr: &RuleSet_ipcidr {type: http, behavior: ipcidr, interval: 43200, format: text, proxy: 🚀时光太浅1994}
RuleSet_filter: &RuleSet_filter {type: http, behavior: domain, interval: 43200, format: mrs, proxy: 🚀时光太浅1994}

rule-providers:
  fakeip-filter:
    <<: *RuleSet_filter
    url: https://testingcf.jsdelivr.net/gh/DustinWin/ruleset_geodata@mihomo-ruleset/fakeip-filter.mrs
    path: ./rule_set/other_ruleset/fakeip-filter.mrs
  cn:
    <<: *RuleSet_filter
    url: https://testingcf.jsdelivr.net/gh/DustinWin/ruleset_geodata@mihomo-ruleset/cn.mrs
    path: ./rule_set/other_ruleset/cn.mrs
  private:
    <<: *RuleSet_filter
    url: https://testingcf.jsdelivr.net/gh/DustinWin/ruleset_geodata@mihomo-ruleset/private.mrs
    path: ./rule_set/other_ruleset/private.mrs
  trackerslist:
    <<: *RuleSet_filter
    url: https://testingcf.jsdelivr.net/gh/DustinWin/ruleset_geodata@mihomo-ruleset/trackerslist.mrs
    path: ./rule_set/other_ruleset/trackerslist.mrs
  reject_non_ip_no_drop:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/reject-no-drop.txt
    path: ./rule_set/sukkaw_ruleset/reject_non_ip_no_drop.txt
  reject_non_ip_drop:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/reject-drop.txt
    path: ./rule_set/sukkaw_ruleset/reject_non_ip_drop.txt
  reject_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/reject.txt
    path: ./rule_set/sukkaw_ruleset/reject_non_ip.txt
  reject_domainset:
    <<: *RuleSet_domain
    url: https://ruleset.skk.moe/Clash/domainset/reject.txt
    path: ./rule_set/sukkaw_ruleset/reject_domainset.txt
  reject_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/ip/reject.txt
    path: ./rule_set/sukkaw_ruleset/reject_ip.txt
  cdn_domainset:
    <<: *RuleSet_domain
    url: https://ruleset.skk.moe/Clash/domainset/cdn.txt
    path: ./rule_set/sukkaw_ruleset/cdn_domainset.txt
  cdn_non_ip:
    <<: *RuleSet_domain
    url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt
    path: ./rule_set/sukkaw_ruleset/cdn_non_ip.txt
  stream_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/stream.txt
    path: ./rule_set/sukkaw_ruleset/stream_non_ip.txt
  stream_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/ip/stream.txt
    path: ./rule_set/sukkaw_ruleset/stream_ip.txt
  ai_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/ai.txt
    path: ./rule_set/sukkaw_ruleset/ai_non_ip.txt
  telegram_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/telegram.txt
    path: ./rule_set/sukkaw_ruleset/telegram_non_ip.txt
  telegram_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/ip/telegram.txt
    path: ./rule_set/sukkaw_ruleset/telegram_ip.txt
  apple_cdn:
    <<: *RuleSet_domain
    url: https://ruleset.skk.moe/Clash/domainset/apple_cdn.txt
    path: ./rule_set/sukkaw_ruleset/apple_cdn.txt
  apple_services:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/apple_services.txt
    path: ./rule_set/sukkaw_ruleset/apple_services.txt
  apple_cn_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt
    path: ./rule_set/sukkaw_ruleset/apple_cn_non_ip.txt
  microsoft_cdn_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt
    path: ./rule_set/sukkaw_ruleset/microsoft_cdn_non_ip.txt
  microsoft_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/microsoft.txt
    path: ./rule_set/sukkaw_ruleset/microsoft_non_ip.txt
  download_domainset:
    <<: *RuleSet_domain
    url: https://ruleset.skk.moe/Clash/domainset/download.txt
    path: ./rule_set/sukkaw_ruleset/download_domainset.txt
  download_non_ip:
    <<: *RuleSet_domain
    url: https://ruleset.skk.moe/Clash/non_ip/download.txt
    path: ./rule_set/sukkaw_ruleset/download_non_ip.txt
  lan_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/lan.txt
    path: ./rule_set/sukkaw_ruleset/lan_non_ip.txt
  lan_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/ip/lan.txt
    path: ./rule_set/sukkaw_ruleset/lan_ip.txt
  domestic_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/domestic.txt
    path: ./rule_set/sukkaw_ruleset/domestic_non_ip.txt
  direct_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/direct.txt
    path: ./rule_set/sukkaw_ruleset/direct_non_ip.txt
  global_non_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/global.txt
    path: ./rule_set/sukkaw_ruleset/global_non_ip.txt
  domestic_ip:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/ip/domestic.txt
    path: ./rule_set/sukkaw_ruleset/domestic_ip.txt
  china_ip:
    <<: *RuleSet_ipcidr
    url: https://testingcf.jsdelivr.net/gh/Seameee/override-hub@refs/heads/main/mergecnip/china_ip.txt
    path: ./rule_set/sukkaw_ruleset/china_ip.txt

### 分流规则
rules:
  - RULE-SET,reject_non_ip,REJECT
  - RULE-SET,reject_domainset,REJECT
  - RULE-SET,reject_non_ip_drop,REJECT-DROP
  - RULE-SET,reject_non_ip_no_drop,REJECT
  - RULE-SET,cdn_domainset,🚀时光太浅1994
  - RULE-SET,cdn_non_ip,🚀时光太浅1994
  - RULE-SET,stream_non_ip,🚀时光太浅1994
  - RULE-SET,telegram_non_ip,🚀时光太浅1994
  - RULE-SET,apple_cdn,DIRECT
  - RULE-SET,download_domainset,🚀时光太浅1994
  - RULE-SET,download_non_ip,🚀时光太浅1994
  - RULE-SET,microsoft_cdn_non_ip,DIRECT
  - RULE-SET,apple_cn_non_ip,DIRECT
  - RULE-SET,apple_services,🚀时光太浅1994
  - RULE-SET,microsoft_non_ip,🚀时光太浅1994
  - RULE-SET,ai_non_ip,🚀时光太浅1994
  - RULE-SET,global_non_ip,🚀时光太浅1994
  - RULE-SET,domestic_non_ip,DIRECT
  - RULE-SET,cn,DIRECT
  - RULE-SET,direct_non_ip,DIRECT
  - RULE-SET,lan_non_ip,DIRECT
  - RULE-SET,reject_ip,REJECT
  - RULE-SET,telegram_ip,🚀时光太浅1994,no-resolve
  - RULE-SET,stream_ip,🚀时光太浅1994
  - RULE-SET,lan_ip,DIRECT,no-resolve
  - RULE-SET,domestic_ip,DIRECT
  - RULE-SET,china_ip,DIRECT
  - MATCH,🚀时光太浅1994
